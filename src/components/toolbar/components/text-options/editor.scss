// Shared button mixin for toolbar buttons - must be defined before use
@mixin toolbar-button-base {
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	padding: var(--mx-btn-padding) !important;
	min-width: var(--mx-btn-width) !important;
	max-width: var(--mx-btn-width) !important;
	height: var(--mx-btn-size) !important;
	border: var(--mx-border) !important;
	border-radius: var(--mx-radius) !important;
	background: var(--maxi-white) !important;
	color: var(--maxi-black) !important;
	cursor: pointer !important;
	font-family: inherit !important;
	font-size: var(--mx-font-size) !important;
	font-weight: normal !important;
	line-height: var(--mx-line-height) !important;
	text-align: center !important;
	text-decoration: none !important;
	transition: var(--mx-transition) !important;
	box-sizing: border-box !important;
	margin: 0 !important;

	// SVG icon styling
	svg {
		width: var(--mx-icon-size);
		height: var(--mx-icon-size);
		transition: var(--mx-transition);

		path {
			stroke: var(--maxi-black);
			fill: none;
			transition: var(--mx-transition);
		}
	}

	&:hover {
		border-color: var(--maxi-primary-color) !important;
		background: var(--maxi-light-blue) !important;

		svg path {
			stroke: var(--maxi-primary-color) !important;
		}
	}

	&[aria-pressed='true'] {
		background: var(--maxi-whisper-green) !important;
		color: var(--maxi-primary-color) !important;
		border-color: var(--maxi-primary-color) !important;

		svg path {
			stroke: var(--maxi-primary-color) !important;
		}
	}

	// Text-based button styling
	.toolbar-item__text {
		font-family: inherit;
		font-size: var(--mx-font-size);
		font-weight: normal;
		line-height: var(--mx-line-height);
		color: inherit;
		transition: var(--mx-transition);

		&--italic {
			font-style: italic;
		}
		&--underline {
			text-decoration: underline;
		}
		&--strikethrough {
			text-decoration: line-through;
		}
		&--capitalize {
			text-transform: capitalize;
		}
		&--uppercase {
			text-transform: uppercase;
		}
		&--lowercase {
			text-transform: lowercase;
		}
	}

	// Bold styling for bold button
	&.toolbar-item__bold .toolbar-item__text {
		font-weight: bold;
	}
}

// Main container for the toolbar popup with CSS custom properties
.toolbar-item__popover {
	/* One source of truth for spacing in this row */
	--toolbar-gap: 6px;

	/* Spacing tokens */
	--mx-gap-xs: 4px;
	--mx-gap-sm: 5px;
	--mx-gap-md: 8px;
	--mx-gap-lg: 10px;

	/* Button dimensions */
	--mx-btn-size: 32px;
	--mx-btn-width: 34px;
	--mx-btn-padding: 8px;
	--mx-icon-size: 16px;
	--mx-icon-sm: 14px;

	/* Border and radius */
	--mx-border: 1px solid var(--maxi-grey-light);
	--mx-radius: 4px;

	/* Typography */
	--mx-font-size: 16px;
	--mx-line-height: 1;

	/* Transitions */
	--mx-transition: all 0.2s ease;

	// Container for font-related options
	.toolbar-item__popover__font-options {
		margin: calc(var(--mx-gap-md) * -1) calc(var(--mx-gap-xs) * -1) 0;

		// Wrapper for font controls
		&__wrap {
			display: flex;
			align-items: center;
			border-top: var(--mx-border);

			// Styles for base control elements
			.maxi-base-control .components-range-control {
				display: none;
			}

			// Default SVG icon styling
			svg {
				fill: none;
				&:hover {
					fill: none !important;
				}
			}
		}

		// Shared button styling for toolbar formatting buttons
		.toolbar-item__typography-control__extra-text-options {
			display: flex;
			align-items: center;
			gap: var(--toolbar-gap);
			margin: var(--mx-gap-xs) 0;
		}

		// Kill stray margins/padding from wrappers
		.toolbar-item__typography-control__extra-text-options > * {
			margin: 0 !important;
			padding: 0 !important;
			border: 0 !important;
		}

		// Make ALL the button types identical boxes
		.toolbar-item__typography-control__extra-text-options .toolbar-item,
		.toolbar-item__typography-control__extra-text-options
			.toolbar-item__popover__list-options__button,
		.toolbar-item__typography-control__extra-text-options
			.maxi-alignment-control
			.maxi-tabs-control__button {
			@include toolbar-button-base; /* uses your --mx-* tokens */
			flex: 0 0 auto; /* prevent stretch */
			min-width: var(--mx-btn-width) !important;
			max-width: var(--mx-btn-width) !important;
			height: var(--mx-btn-size) !important;
			margin: 0 !important;
		}

		// Apply sidebar styles to toolbar formatting buttons specifically
		.toolbar-item__typography-control__extra-text-options
			.toolbar-item__bold,
		.toolbar-item__typography-control__extra-text-options
			.toolbar-item__italic,
		.toolbar-item__typography-control__extra-text-options
			.toolbar-item__underline,
		.toolbar-item__typography-control__extra-text-options
			.toolbar-item__strikethrough,
		.toolbar-item__typography-control__extra-text-options
			.toolbar-item__superscript,
		.toolbar-item__typography-control__extra-text-options
			.toolbar-item__subscript {
			@include toolbar-button-base;
			flex: 0 0 auto;
			min-width: var(--mx-btn-width) !important;
			max-width: var(--mx-btn-width) !important;
			height: var(--mx-btn-size) !important;
			margin: 0 !important;

			// Text glyph styling matching sidebar
			.toolbar-item__text {
				font-family: inherit;
				font-size: var(--mx-font-size);
				line-height: var(--mx-line-height);
				color: currentColor;
				transition: var(--mx-transition);

				&--bold {
					font-weight: bold;
				}
				&--italic {
					font-style: italic;
				}
				&--underline {
					text-decoration: underline;
				}
				&--strikethrough {
					text-decoration: line-through;
				}
				&--small {
					font-variant-caps: small-caps;
				}
				&--big {
					// Use slightly larger font for Aâ‚‚ glyph
					font-size: calc(var(--mx-font-size) * 1.1);
				}
			}
		}

		// Keep the alignment group as its own row container,
		// but give it the SAME gap as the outer row
		.toolbar-item__typography-control__extra-text-options
			.maxi-alignment-control
			.maxi-tabs-control {
			display: inline-flex; /* NOT display: contents */
			gap: var(--toolbar-gap);
			margin: 0;
			padding: 0;
			border: 0;
		}

		// Optional: ensure the alignment group wrapper itself doesn't add spacing
		.toolbar-item__typography-control__extra-text-options
			.maxi-alignment-control {
			display: inline-flex; /* wrapper collapses to its content width */
		}

		// Typography tabs section (alignment, font selection, etc.)
		.toolbar-item__typography-control__typography-tabs {
			.maxi-tabs-control {
				margin: 0;

				&__button {
					border-color: var(--maxi-grey-light);
					border-style: solid;
					border-width: 0 1px 0 0;

					&:first-child,
					&:last-child {
						border-radius: 0 !important;
					}
				}
			}

			& > .maxi-tabs-control .maxi-tabs-control__button {
				height: 36px;
				justify-content: center;
				width: 45px;
				gap: 0;
			}

			.maxi-alignment-control .maxi-tabs-control__button {
				@include toolbar-button-base;
				padding: 0;
				margin: 0;

				svg {
					width: var(--mx-icon-sm);
					path {
						stroke: var(--maxi-black);
						transition: var(--mx-transition);
					}
				}
			}

			.maxi-tabs-content:not(.maxi-tabs-content--disable-padding) {
				padding-left: 0 !important;
				padding-right: 0 !important;
			}

			.maxi-font-family-selector__control__control {
				border-style: solid;
				border-width: 0 1px 0 0;
				height: 36px;
				min-height: 36px;
			}

			.maxi-font-family-selector__control__menu {
				margin: 0 !important;
				width: 200px;
			}
		}
	}

	&__advanced-button {
		position: absolute;
		top: -10px !important;
		right: -10px !important;
		left: auto !important;
		min-width: 22px !important;
		height: 22px;
		padding: 0 !important;
		background-color: var(--maxi-primary-color);
		border-radius: 50%;
		transform: translate(0, 0);

		&:hover {
			background-color: var(--maxi-secondary-color);
		}

		svg {
			width: var(--mx-icon-size);
			fill: var(--maxi-white);
		}
	}

	&__font-options {
		min-width: 376px;

		&__font {
			display: flex;
			width: 100%;

			&__selector {
				flex-basis: 100%;
			}

			.maxi-font-family-selector {
				margin-bottom: 0;
				width: 115px;
				height: 38px;

				svg {
					fill: var(--maxi-black) !important;

					&:hover {
						fill: var(--maxi-primary-color) !important;
					}
				}

				&__button {
					color: var(--maxi-white);
					border-color: var(--maxi-grey);
				}
			}

			.components-maxi-control__reset-button {
				height: 36px;
				margin: 0;
				border: none;

				svg {
					width: var(--mx-icon-sm);
					height: var(--mx-icon-sm);
				}
			}
		}

		&__wrap {
			&_family .maxi-base-control__field {
				margin-bottom: 0;

				.maxi-font-family-selector__control__control:hover {
					background-color: var(--maxi-white);
					cursor: pointer;
				}
			}

			&_inputs {
				padding: var(--mx-gap-lg) var(--mx-gap-lg) 0;

				.maxi-advanced-number-control {
					margin-right: var(--mx-gap-md);

					&:last-child {
						margin-right: 0;
					}

					input {
						width: 80px !important;
					}
				}

				.toolbar-item__text-size-icon {
					margin-bottom: var(--mx-gap-md);
					margin-right: 3px;
				}
			}
		}

		.maxi-tabs-content {
			padding-top: 0 !important;
		}
	}
}

.maxi-toolbar__popover {
	.toolbar-item__typography-control {
		width: 40px !important;

		& > div {
			width: 100%;
			height: 100%;
		}

		.components-button {
			font-family: 'Inter', sans-serif !important;
			font-weight: 700;
		}
	}
}

.toolbar-item__bold:hover {
	stroke: currentColor !important;
	fill: none !important;

	path {
		fill: none !important;
	}
}

// List options styling - using shared button base
.toolbar-item__typography-control__list-options {
	display: flex;
	gap: var(--mx-gap-sm);
	margin: var(--mx-gap-xs) 0;
	padding-left: var(--mx-gap-md);
	border-left: var(--mx-border);

	.toolbar-item__list-button {
		@include toolbar-button-base;
	}
}
